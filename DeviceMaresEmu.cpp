#include "DeviceMaresEmu.h"
#include "Logger.h"

DeviceMaresEmu::DeviceMaresEmu()
{
	memset(memory, 'F', 90000);
	memcpy(memory+0x0100*2,"07D604020005001A0128107080A0201000000C1900000000FE006C0400040F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0E0007D707180B2D005500CC107080A0201000000C1100000000FE00C60410280F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D70718100E005000A2107080A020100000110D0000F204FE0107040F0410291023101910121017102810531073108B1066000007D7071A0B1B004C00C4117080A420100000120D0000F200FE01070416280F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D7071A0F2F007000C50F7880A420100000000D0000F200FE0107041417133A15931662151213E61318121B118810E51032000007D70802131300420038157080A0201000000D0C00000000FE000D0410060F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D708100A1400610076117080A0201000000C0C00000000FE00EA04142A0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D708100F36005D00C8117080A0201000000C0E00012E06FE0122041A180F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D708110A02005700F1117080A0201000000E1100042218FE01360418110F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D708110F1500610139117080A020100000111201012304FE017F041823104110351030102E10321041107410A710E210DB000007D708120A0B007A0092117080A020100000120C01044A17FE013B0410350F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D708120F1A006100C1117080A0201000000C1002011304FE016B041A2410010FFC0FFC0FFD100410171055108F10D310D3000007D709071134006400C90E7080A020100000101100000000FE00F304192D0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D7090F0929004C00E1127080A020100000111000000000FE011304202E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D7090F0F240050016D127080A020100000101800014906FE01810419351078105B10491041104110481067108910B510B00F0007D709161009007E01570F7080A020100000181400000000FE01810422110F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D709170A2A0076019B0D7080B020100000142000043013FE0191041D250F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E100007D70A060A340041016B117080A020100000201D00000000FE0144041A3A0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F0007D70A060F3A00480172113080A0201000001D1700011D05FE017F041B0E109A106B1050104110421052108B10C3110010F30E0007D70B021005005D01750F3080A020100000171500000000FE016C0423110F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E100007D8021603330010003B097080A0201000000C0C00000000FE05A004232A0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D8030F0704009500C51C7080A0201000000C1200000000FE013D0415010F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D8030F1509001E00C21B7080A020100000121100031C0EFE005204000E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D80501160E006600BC0B3080A020100000111000000000FE014204230A0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D805020331006A00B50C3080A020100000100F00012E06FE017904232510721071106E106A106D107910A910DB1115110A000007D80502141A0054015C0C3080A0201000000F170003C216FE015A0423130F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0D0007D805030424008E00B70C3080A020100000170F01019305FE01380421240F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D8080B0905006E0189133080B0201000000F1B00000000FE018F0416350F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0D0007D8080D0904007D0176123080B0201000001B1B00000000FE01770417000F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0D0007D8080E083900640163113080B0201000001B1C00057018FE018504112A0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0E0007D8080F08380067015F123080A0201000001C1901057F17FE016B04102A0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0E0007D604080D23008200BB133080A0201000000C0E00000000FE01490413240F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D604090D320091007E153080A0201000000E0C00058418FE00F70417280F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D906050D2300A10077143080A0201000000C0C00000000FE00FE04152F0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007D90606081D00550122123080A0201000000C1900043A13FE016E041B1E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0D0007D9060708160064010C133080A020100000191601057E11FE017A041B250F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007DA06150E060063006E163080A020100000160C00000000FE00F70421130F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007DA06190E020083006D123080A0201000000C0C00000000FE00D404212E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E000007DA061A083700580124113080A0201000000C1800044213FE015C0410290F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0D0007DA061A0A140057009E123080A020100000180E00003814FE019204210511BE11BD1223140615181565151C148C138B11EB000007DA061D0E0E0088007B163080A0201000000E0C00000000FE012C0413270F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0F6E0000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF", 5204);
	memcpy(memory+0x0B30*2,"2100210021005E00C3002001230123012401260127012801240123A106A1E180C3809EA075A04EA029602A002B002C002D002D007F00BC00C400C720C720CC00C620C4A0AAA07F0078A063A00000000000000000000000000000000043A051009400C400C140BEA072A0AD00C940BF40B9A08EA05CA035802220000000000000000000003A408D00C000C420B9A08FA051A02E4000000000000000002BA04D00670072007040640069006A006F00772079207280710073007340724066005A2050404BA0342034803000320030602B002B002F2037803440396030A024801B002B0031203100310031002E60342053007D00890096208FA092608900882094009900A22097A085408C009800978095009800996090208F20884090A098A08B6086007F607480728074A05D605E005E605CA05CA051A0532056005600582053A052004C204C40416043A0000024A037003D00420043403F403E803920340032602C203D003E2048004E604AA039A040004200510055804C8040A03BA030601D004D009D00BE00BA00BC00BAA095A039A020201FA00000000000000000000000000000000011A029006D00B200C420C1A000000000000000000000000072A06D00B100C300C2A05AA02B005D00660070007E207E0077207A007D0082407B20772078207A00874085407BA05FA000000000000000000000000026A0360048A0424038602860234025002560232023002500290028802960490076009D00BF00C5A0A6A04EA05500610066A052A033A0250038600000000000000000000000002CA06300B100C380BC40B0A0A9A08EA0AD40B220BC00BEA0AEA0A0A088A00000000000004AA0270032003E2051A05F80730084009900976083A09A00B020AE40B140AF40B320AF40AD40AF60A700B040AA00A860A7209F609300982097009C009F2099A084A07FA071407300810083807C007E207660724073206C8066205A2067006E0075A063A06A2066006800652065405F406020582049A03C003D203C004700452044A03BA0442048A033203540330030002E4020601C40000000001CA027002E003420300031402C002F002C602D402240280027002C002F0032203860360033203300370036402B0025002220220029002C402300220029002AA02260000017601A4020002600230023001F001F0029002E002DA02A002D0030A01E001F001A2015001A001F001F001E601800182019001A001700150010003600610064406A006B206820682067206D40750076007600742076607400712068405BA0630068405F8059005DA057006C006BA06400644061A056605240520055005E0060005A2052405700600060805E4064806120620064A060405E205C005F006020678062205F406100610068A061A0620066006B006D2069406D806B6062A063405D005F0062205C005E60540060005C80574052005A2055805140514047A04C005900560061A056205100580057A057205800580056404E6049003F803240530075009A00AA00B400B520AF00B080A0A09B6094809580914094408F00910093608D208AA080607C60722076A06EA05B006C4083408E0099009F00A900A820A720B300C220C280C840C340C220BA20A900A460A360A1809B409B609580980098009940990097408B4080007B207C2083008460784072407C008000812082207E207E407D00782076007200766077007D0088008720860089008B6083807F0084207A20784071A063605A8050005700542057604AA02F202B4032005C008500A500BB00D100E600ED00F100EE20EA40E680DE00DC60CC20C740C120BF40BCA0BA20B920AF40B6A0B400BC20C620C620BFA0BD80AB40A820AA00B900C700C940D620D840DA40DC20D640CB20CC20CB40C900C280B7A0A1A08EA08DA09700A800A9609F00A100A3209F809E009D2091A079A06F4074007AA092009520926089A088009400902088607D008D209F009E80954097408CA0778071A06DA06BA06BA056A03CA039202FA072008900AA00B460AFA092A09200B600C200E600FB002B01370139812BA11F21200122012A01330133A118810081F7A0E5A0D220CC80B720B740A820B940B940B860CF00D120D900DA00DA00E500E500E540D980CAA0BD00C160BA60C700D200D2A0C580B680A4A08AA07E00812087409840AC00A9A0B000B620B660B360B160AD20AB80A640A640A0409A6094A099609B2096409B209E409C60976096A089A08BA089A095809BA099A08EA08E008DA0758076A06CA053A044A042A03360312029805100714076008C208B008C008CA0870086A082007F607D20860085A08560844086808520842086008700874089008B008920860085208560870089008900884087408A008B208A20872085008820890087807E6079A080207E207F6084008200850083208A008E0092608D40860081007F0083007E607D007F2087008340740079007E007D4071007500788069A06A00760074A067006C207A007A0074206EA06800710070207800764074007500754078007B007C007A0078407A607F207EA078007BA06E20770079A07D0083008340812085008800838077406E406A0076007E4078407E007AA05F205B40534045403E6022A0520074009100924093A097009B20A8A0A0609B20A160AB80B300B3A0B360B860B7A0B720B620B440BA40BA20BA60BCA0BB80BB80BA80B660BDA0C080C1A0BC40BD20BE00C120BDA0BA60BD20BA80B980B860B660ACA0B5A0B7A0A320A660A7A09F609B80964097A0A020A4A0A0A0A600AEA0A840A760B140B8A0B560B4A0B260AD20A740A400A420A3A096808CA08B4096A094A08480828082A0870087A08C008D608DA082A06FA07300810081A072A064A0670069605DA05AA057804C4040A031A05500790090009E00A400A800A900A900B120AD00AF00B300B500B100B100B400BC00C200C440C600C920C020BE00C020C740BE40B5A0A7A091A079A051A044602DA01A401140150010A0110016201F001E2015801300132000000000174020002C002B20292036003D602D4024003100320053205C005FA05C407C0078A04EA05F00810080A064A05520584052005120482043204F00590058205A205F405E805B006400670065006800670068206480532045A03F803A00402049203FA0404042A04A0048603DA02500290038003C0045404D2050A0528052605400750084A07640950097A083A082A08A009B009BA0A500A5809BA0AF00B380B600C500D200D700E1A0DD20D600D040BF20C800CB00D160C800C120C160B260ABA0A400A6A0A820A700A2209B209F00A16096A09A209E00AF40B700BD00BF20B880AC00ACA0AAA09C00A0009E60938090208AA07E408800866078A072A0708060A052404CA0290041006C009000B000AE80B600D300E400F5000A011F0125413541410149015041560166016C016A216D01692163215D2158A15321522150214D0149A1368135612E81172118A10CA1030103810481014100210081EC40E280EA60E060CDA0B7A0AD60AB80B800BC40BD00BAA0ADA09E209E00A400A5809F80A040B500BE20BA40BA40B700C000BE20B440B480ADA093A072A04FA04140400041203C202FA02B002F003FA067008800892088208C40860088008B008B008C008DA0950099209BA08E008D40890089009B00A300A600B600BF20CA40CB00D400D540CC20C500C220C020B920C800D020D500EB00F700FF40FB20F900FD00F82001010401096114012701320142014F015741530153015301504139A1360133A119411201092108010C010E010D01054107A1F3A0EE20E760DC40D260CB00C940BA40A4A0B200BF00C900CD00CD00D100CD20BC60AE60AA20B320AFA0A8809C009C009B00990099009C009C00A520A3A098608B608A008B807E8083407B6067605C4052A03B0032202E60280028202700250024002400240024002700280029402560510081008C008BA0BC00DC0016014601464159016D4191019A019B019B019601960196418A4185018701890191018B4184217D2184217941710172A15E815941560159215D215D2165016C016D0967096A0972097309750974297D097E097E097F0984A977A967295B096109610967295E8941692BA920491C291969066902A9EDA8DA68D468BEA8A68895A880A8674856883C683A28328835283648338836083708302830082F0832083648352834682F4827282F0835083928344836083F083D0841083F083B2030002580198017401A002120214023201F202F0037003C40360038202EA02E00272023402E00390053006800742098A08BA08140742079207F4074006EA066A08600B900E90025014301480157015F015E215D815C815F6153A1550152214A01436140014B0156016301680166016BA166016A01666164015FA1610164015DA140A130A12C811BA10761F3A0B9A0B6A096A074A068406F4071606A4059A03BA0294039A0322076008E00C100D300E30004013901680171017201702169A138A1220129212401242123211881FFA0F620F9A0E3A0CAA0B9A0C000DD00EF00F000F3200A0113810621FD00F360E780D600D400D420D220D100D320D300D480D440D440D500D900DC00E220EF00EF40E8A0E520E740F100F240EA40DF20E060D0A0C220BBA0A6A090A07A0075A0544051A041A0312032204E0070009700C000F9002A015601600172017561684164215C215A2159A13CA1EEA01D014A015C01694163416C016E41690169615AA154014F613F21364129811BA1F7A0ED60DB60C7A0CD00E020E020E020D420D0A0C480B3A0AB40AB20A3009D6093208B00930092208A208A008A0090209200960092208E808E008EA08C408A208B408A20882089008C008E208D009000900090009100900092008E20900090008E808AA086A07D007AA06020630065A050004F80498044A0322038A0000000000000000000000000000022A03B003A0034A00000000000004A008C00B800B920BF20BD00C5A0C0A0C260BAA0A0A08DA074A05DA048A041403C204A204AA03EA03E4037A030A0310037003B2036202E202F2028402EA03EA05200620065006E006E4060A0704073406C00664060A058A050204A6040803FA04F0051204B404E4058A0462042603320390043803B203720364034003D402EA031603A004C204CA052005100610060A05880600064605F0057A03E80362036203120320032002FA02B002B8035A06D009700C400C100C400C240C0A0B9A0B160B700BA00BA80BB00BB00BC00BC00C120C120C140BD40BF20BD00BF00BE00BC60BE00C540C000C100C500C200BF00C100C100C000C040AF20AB8099A077A05F8043A02F40292029002A002A002B002B002A002A002A002800260027002F802BA023201B20150022A016A02600260025002900320032003040340063008B00A320AD00B520BC60BC00C200C100BE00BFA0B400AF409F009CA089407B606CA06F805B404A6040803F0040003B804C004D2048004C00630067A07C007FA0870092008E00944094A08D008EA0A100A200A700A200A120A3209E009B20980099009D209E00A720A820AB20A2A09F209F409D00A2009E409A809B209980A400A7A09CA0A3A0A740A8A0A740A980A700B500B500B5A0B2A0B200B220B140B520B500B500B920B700B900BA20BA00BC00BA00B600B640B600B400B540B460B000AF20A960AB20A600A300A200A4009E0095A095208D4086207F4073A0760072806E206220588044A0440049A04620480043A02CA01860860095009B00A000A320AB00ADA0AE00AB809E209F4092008D208C008A607C80870091209320A100A260972099409B209640988090A095009820A000A220A160A620AA00AE40A780A140A0209E8098009A009E00A600A2A0A040AB20A900AAA0A3609F20A100A340B000AFA0A760AB00AF20AC00AA00AF00B160AC00AC00AC80AD40B520B1A0AB20AE60AB40AAA0AA00A900A9609EA09820922090408C8087A09780A2809D80932090009C00A800A700A800A9A098A080A0840088208AA06AA053803AA02F402C20330033003400342038403380610067206B60628067006E006D40740079007B009900B100D400E000E380F800F6A0F920F9A0F500F700F4601601180115810AA118014001430148613FA1470154015A015C2153214F014E613E41368121A109010B010D010741FF20050107010D010C010B2105810181F420EB20E540D820D120C680C460BE00BD00B840AC00A720988085007E20840086808B00832071A051A03E803F4035A032002F2029A02B402680260024607900A400AC20AF00AEA0A800A820AC00B020A440A800A6209F409B00942093A083008140796077007400708059805200564059205780550053604880480048A0470048004940502051405300528046203D40314031203800440044603860382035803C4033A035803C80450041604200452042003FA044A04E005300530053005200540053004F4053005C005CA043803B403E2040A02E4031603C003680370051006C006C007400772085008F008A60806078806F407340760078009200A120AC00B280B300B500B600B600B600B500B400B300B600B520B700B680AA40A3A091A08E0090408E008A208280718083007EA069A051403D80334031002E4037003B003B00346028A026002B002A0028002800290026002B0027202300580075007F009100B300D800F7001D013B014D0155015C0164016E0174017E0181018201850189218301842178017B017C01766169016C016E01710170216B2163A15E016001610160A15F2155214E29472938892B091E69098909090A69FF08FB28F728EF08ED08EF08EF08EB08F108FA08FCA8EA48EC08EB08EB08EA08E528E108DB08DA08D908D608D128C328B908AE28AB48A9289F289268840884088608880885287B286E086708670863A8554856884C28520851284C084F084E28480845283C0831082C0824082408220022601F001F00200022001F001D8028003C005600680080008D00A300B800C900D900EC00FC000801130126012A013C013F014E0158015E01600163016C01700173016E016D017101754176016FA16B216E016F21608156214E41410147014781404134213721360131212321212918090E69FE28F428E928E108E128D928D508D448C688C1A8B748A6A88B4883288408870888087EA862A863805EA06040594060005EA03B203C20330032403120334035003C0036203500360037003C20398038003D003B4038203B003C003A003E003B203B8031002EA02B0032003600490049004800450048204500470044003D0044004E004E2048004C404D604CA03B80338030002C0030004600640078009300AE00D100E000FE001B0132014C01550153015101510150014A21530154014F61550156214E014C415101560152014C0153016301600154A14F014C0148213CA12CA129012B01230126012301290129013A014B014B41476947094A29480941493D2936493369340928492609228915290C090529FB28ECA8DE08DC48CEA8C028C208BD48CB88BD48ADA8A228A0689068784863485EA83B282E28350836882E082B482F283148320832282A28320832682928280030602D002C602220240023203F004300420040004F00650065006400704090009E00B900C620D200F70004010C011401300144014441440144213F812D611C6112011D012F014A014D2155015A015B215F015E8154214E0150014E21430139413241232112211301122105210141FD00F300F800F520EF60DB40E300E900F700F7A0E220DFA0BE00B420B000B000AD00B000A7A09E2096208D40826079A07100710072A06700684066206B4073007440684053204880460044004420480045204D004D4040A02A602C002B0029202A002B202FA02D002E602420550052204E2050005100530057A045605200560058005140560066008000900095408B00864088208900880085008500930093608B008A008A008A209A8091A083209B009D009C009F00AE00B900B720B700BB20B620B400AD00A1009C009C20970092009300970098409540950096208F40910095208D2081007D007E2074007D0084008E00920096808B008A0087207E008400930093408400800082007F007A007B00780072206C006F007500750075006F006C006A205F006A006C0071007020680066805E40650064A05C0062006B006E0071007000710069007400720074007500760076007000710073006F00600056204CA03FA03D003D403C003EA0358036A013001340100014001500150018001A0019001B00220024002B002D002D002D0032002F002B002F00318020002C003800362032002E002900262023A0290034003A003C003C00", 12000);
	memcpy(memory+0x0B30*2+12000,"3B003C003B402C6024001E40150016001B00190019003300400043004800520057005B205A205A8059005820590056A041204100400043004F0067006900684054A0430045004B004B0045203A00380036402B00300040004C0053005D005C005C0057005F00660066605A005B005F0064006A006B2074007E007E007900760071406620610060005D005F005A0056204F005800620062005F40584053005600570057005C006000630064006D006A0062205E4050004E00480048203B003A003B003A00314030002F002D002B0025201C401D40180017201100100036003900370036003800350037003B2031002A402600240027002800260028402A002F403A40440044203C2035003000340034003300324021A01800200026002A00320030002F202C002A003300420045404B0057005F205A007600776073006E206E206B006B006D0070006EA067006900642067006500670067006500644061405D6061005F604DA04B004B20460044004300410041003C40370037003D003A403D003F003B2047004B004D0050A041A0580058205200520059006000610064006B2062A05F006100620060005F005C005A005A2050004E0050204D004C004B0048203F40340041003F6035802380190019001600170018601940192018A018001900190016202F00340034003400338020A0180016001A00260028402B0037003A00400041004200460049004800420040003D403100340041203A2036801C6061009D00D400EE0003010B0118011C011B011A011C01220122011C011E011D011C011E01192113011C0118211201110113010E010701080106010D0109010B01140117611001140115010D2111010F6105010421030104010AA1FDA00841FF00070104010201FF0003010241FE0006010021F900F380F500FB000001FE80EE60E220D820CDA0C020BF20B0A09CA086A074A053A042204400442043603E4037003A20384032402F2023A047008100BD00CA00D300D900E600F500F620F800000102010301040103010401030102010401020104010301050107010C010A0106010501FE00FC00FE00FE00F840F600FC00FF00FB20F940FA00F800FC00FE0000010261FA20FF40F380EE00F360F500F520F060E200E100DE00E520DDA0CC00C500C800C800CA00CA00C400BE20B400B700B600B900BC00C100C320C040CB00CA00CE00D400DE00E600EB60E600E200DB00D140C360B980A0A086A06DA0548035603C003B4038203A003A2036203300360036A04B005E00610067006700660066006AA069A068006B006B0069406700690069006AA067A06A006900682063805F006800670067A05E205D405D406500650065006700620065006A0068006A00690067A069006D006EA06400680067206B006C006BA06320632065006A4067006700670065006A40606063006700662067006600650069406B2069A06980674067006500650062A0630069006800660066006B206720650066205D2052004D4041203A2038203800382034003700396032802D202900350033403E005800578055005B005B0058204E2052004F2050004D204700520055404CA0440042403F203D203E0034002C00270026002B002E002EA047004C004A00452036802D202D20300031403420340033202BA0168018201780194017201C60176019001A001B201620320035603240324024A0000015201700170024002C0031003300350035003E0042004F00580059005E005D005C405D006200602067006B006B006D006D006C006C006B006B006B20660062005F005C005700550053004E004C00460044003F8040003E003D603A003720350033402E202B202B002C002F602F202E002B002A002A002800232021001C0014201500170028002B802B002980210021001B204B008C00C800EB00E860EA20F9000101040109010801050107010B01150114010F010F0110011101112114410F0114010EA10F01162110411C011C411AA11CA11F4118011F4123012401204116610E2105010121FF00F900FB00FD00FD20F600F900F700FB00FE00000101010021F160E320DC20DB00D880BC20B220AF809A8086207520662059404A00466030203A003B203940320032002B602A002C602D00320034003300314031003500370032603600520069006A206B007A008A0098009E209C009D0096009740902091008D008C808A20820082208320852084008A008C408F0091409200910091009400990097A0934091208F408B008E008A608440808085008400842085008800880090009B009D209C209400930093408E208F009A00990098009A209C609620900092009700940095009020882084407D2071A05C204B60462046403E403D4035003600380036003700342040003C6028A0550056005C0067006A006900680068006B006C206E0071206C0066006A007100704066007040696067006400630062206400640061206100620065006D0068006C60680068006D0073007A007A007B007B2078007300740076206D00670068006900674060005E405D00630061205D405E0064206500650065006E006F206B407200782072006D006A2073006F606E0071006D0066006940660064006A006DA06B0062005E206200630063006280624060006100620067006920632059005D005B0058005A00560059005D0060005F005E005F00600061006600692067006F00700070006C206500610060006500670064205F20542045403620380039203B003A003A003A003B0039003A0034602740FFFFFFFFFFFF", 4000);

	memset(map, 0, 256);
	map[(unsigned)'0'] = 0;
	map[(unsigned)'1'] = 1;
	map[(unsigned)'2'] = 2;
	map[(unsigned)'3'] = 3;
	map[(unsigned)'4'] = 4;
	map[(unsigned)'5'] = 5;
	map[(unsigned)'6'] = 6;
	map[(unsigned)'7'] = 7;
	map[(unsigned)'8'] = 8;
	map[(unsigned)'9'] = 9;
	map[(unsigned)'A'] = 10;
	map[(unsigned)'B'] = 11;
	map[(unsigned)'C'] = 12;
	map[(unsigned)'D'] = 13;
	map[(unsigned)'E'] = 14;
	map[(unsigned)'F'] = 15;

	position = 0;
}

int DeviceMaresEmu::open(){ return(0);}
void DeviceMaresEmu::close(){}
int DeviceMaresEmu::write_serial(unsigned char *buff,int len)
{
	//usleep(100000);
	if (buff[1] == '5' && buff[2] == '1')
	{
		memcpy(command, buff, len);
		position = map[buff[5]]*16*16*16+map[buff[6]]*16*16 +map[buff[3]]*16+map[buff[4]];

		LOGINFO("Reading memory at 0x%.1s%.1s%.1s%.1s : %d", buff+5,buff+6, buff+3, buff+4, position);

		//len requested is in bytes... so 2 chars per byte
		int ans_len = (map[buff[7]]*16 + map[buff[8]])*2;

		unsigned char crc =0;
		char str[3];

		crc = generate_crc(memory+position*2, ans_len);
		sprintf(str, "%02X", crc);

		for (int i=0; i<len;i++) answers.push_back(buff[i]); 
		answers.push_back('<');
		for (unsigned int i=position*2; i<position*2+ans_len;i++) 
		{
				//LOGINFO(L"preparing %02X", memory[i]);
				answers.push_back(memory[i]); 
		}
		answers.push_back(str[0]);
		answers.push_back(str[1]);
		answers.push_back('>');
	}

	return(len);
}

unsigned char DeviceMaresEmu::generate_crc(unsigned char *string, int len)
{
	unsigned char crc;
	crc=0;
	for (int i=0; i<len; i++)
		crc+=string[i];
	return(crc);
}


int DeviceMaresEmu::read_serial(unsigned char * buff, unsigned int len, int timeout)
{
	unsigned int i;
	
	for (i=0; i< len && answers.size() > 0; i++)
	{
		//LOGINFO(L"sending %02X", answers[0]);
		buff[i] = answers[0];
		answers.erase(answers.begin());
	}
	
	//usleep(100000);
	return(i?i:-1);
}

